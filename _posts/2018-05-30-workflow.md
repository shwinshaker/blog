---
title: automate blog platform 
author: Shwin
layout: post
category: technique
tags: AppleScript, Workflow
---

### 使用Alfred workflow自动生成工作区
# 需求场景
每次要写博客的时候，都至少要打开3个网页，`jekyll`生成的`localhost`，github上托管的页面，以及一些用于参考的站点等等。另外还需要打开至少两个iterm窗口，一个用来运行`jekyll`命令，一个用来打开本地网页资源文件夹。这些重复性的劳动能不能让Mac自动运行呢？

# 思路
既然是在Mac下，自然想到了`Alfred`这一宝物，如果任性一点花30刀买一个`Workflow`，就可以变身成神器了。另外再善加利用`Apple script`来自动执行脚本，以及`Moom`等窗口排版插件，我们就可以做到一键生成工作区啦！

# 步骤

1. 使用`Apple Script`自动打开应用  
* 打开两个`iterm`窗口，进入资源文件夹，并分别运行`jekyll`服务和`git`信息输出
```
tell application "iTerm"
	create window with profile "Blog"
	tell the current session of the current window
		write text "jekyll serve"
	end tell
end tell
```
```
tell application "iTerm"
	create window with profile "Blog"
	tell the current session of the current window
		write text "git status"
	end tell
end tell
```
这里在`iterm`里预置了名为`Blog`的`Profile`，其工作文件夹即位于网页资源文件夹，或者当然也可以直接在上述`Apple Script`里`cd $TARGET_DIR`  
* 打开`Safari`，并分别打开`localhost`,`github-blog`和`font-awesome-reference`(一个小图标的参考网站)
```
tell application "System Events"
	tell process "Safari"
		click menu item "New Window" of menu 1 of menu bar item "File" of menu bar 1
	end tell
end tell
tell application "Safari"
	set URL of current tab of front window to "https://shwinshaker.github.io/blog/"
	set URL of (make new tab at front window) to "http://127.0.0.1:4000/blog/"
	set URL of (make new tab at front window) to "http://fontawesome.dashgame.com"
end tell
```

2. Moom  
[Moom](https://manytricks.com/moom/)是一个窗口管理软件，支持快捷键缩放和移动任意窗口，在这里可以用于网页和终端窗口的合理排版。  
首先按照自己的习惯布置好网页窗口和终端窗口，然后在Moom的Custom里增加一个宏，操作选为`Arrange Windows`，`Title`设为`Blog`，随意设置一个快捷键，然后点击`Save Snapshot`。  
当然我们还需要把这个操作也脚本化，相应的`AppleScipt`可以这么写
```
tell application "Moom"
	arrange windows according to snapshot named "Blog"
end tell
```
这样就可以自动用Moom里的名为`Blog`的`snapshot`进行排版了

3. Alfred Workflow  
到这里准备工作都做完啦，只要用Workflow把以上所有都自动化和流程化就行了。    
在Alfred的Workflows里新建一个流程，添加以下操作块：
* Inputs-Keyword： `Keyword`设为blog，`Argument`选为`No`，这样就可以直接在`Alfred`里输入`blog`来调用这个`Workflow`了
* Actions-Run NSAppleScript * 4： 分别拷贝上述4个脚本至`on alfred_script(q)`和`end alfred_script`之间  
然后就是将这些操作块连接起来，`Inputs`当然是放在入口，然后可以同时执行打开网页、打开两个终端的操作，排版则放在最后。

# Over
成功啦！现在只要在`Alfred`里键入`blog`，就会嗖嗖地打开所需要的网页和终端执行命令，并按照自己的习惯做好排版。  
**Enjoy it!**

# Reference
[AppleScript@知乎](https://www.zhihu.com/topic/19627404/top-answers)  
[用Alfred大幅提升操作效率 - workflow](https://zhuanlan.zhihu.com/p/19986749)  
[Use AppleScript to Automate with iTerm](https://tj.ie/use-applescript-to-automate-with-iterm)  